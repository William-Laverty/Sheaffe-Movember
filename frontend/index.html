<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movember Distance Tracker - Sheaffe House</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="styles/styles.css" rel="stylesheet">
    <style>
        * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
}

body {
    background: linear-gradient(109.6deg, rgb(245, 239, 249) 30.1%, rgb(207, 211, 236) 100.2%);
    min-height: 100vh;
    padding: 2rem;
}

.container {
    max-width: 800px;
    margin: 0 auto;
    background: white;
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    padding: 2rem;
}

.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
}

.title {
    padding-top: 20px;
    padding-left: 10px;
    font-size: 2.5rem;
    color: #333;
}

.subtitle {
    padding-left: 10px;
    color: #666;
    font-size: 1.5rem;
    margin-top: 0.5rem;
}

.user-controls {
    display: flex;
    gap: 1rem;
}

.icon-button {
    background: #f0f0f0;
    border: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: background 0.3s ease;
}

.icon-button:hover {
    background: #e0e0e0;
}

.progress-section {
    background: #f8f8f8;
    border-radius: 15px;
    padding: 1.5rem;
    margin-bottom: 2rem;
}

.progress-title {
    font-size: 1.2rem;
    color: #555;
    margin-bottom: 1rem;
}

.progress-bar {
    background: #fff;
    border-radius: 10px;
    height: 60px;
    display: flex;
    align-items: center;
    padding: 0 1rem;
    position: relative;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
}

.progress-text {
    font-size: 1.2rem;
    font-weight: 600;
    color: #333;
    z-index: 1;
}

.footsteps {
    position: absolute;
    right: 20px;
    display: flex;
    gap: 5px;
}

.footstep {
    color: #666;
    font-size: 1.2rem;
}

.leaderboard-section {
    background: white;
}

.leaderboard-title {
    text-align: center;
    font-size: 1.8rem;
    color: #333;
    margin-bottom: 1.5rem;
}

.leaderboard-entry {
    background: #f8f8f8;
    border-radius: 10px;
    padding: 1rem 1.5rem;
    margin-bottom: 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: transform 0.2s ease;
}

.leaderboard-entry:hover {
    transform: translateX(5px);
}

.rank {
    font-weight: 600;
    color: #333;
    min-width: 100px;
}

.participant {
    flex-grow: 1;
    color: #444;
}

.distance {
    color: #666;
    font-weight: 500;
}

.completed {
    color: #4CAF50;
}

.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

.modal {
    background: white;
    border-radius: 15px;
    padding: 2rem;
    width: 90%;
    max-width: 400px;
    position: relative;
    animation: modalSlideIn 0.3s ease;
}

@keyframes modalSlideIn {
    from {
        transform: translateY(-20px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

.modal-close {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: #666;
    transition: color 0.3s ease;
}

.modal-close:hover {
    color: #333;
}

.modal-title {
    font-size: 1.5rem;
    color: #333;
    margin-bottom: 1.5rem;
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-label {
    display: block;
    margin-bottom: 0.5rem;
    color: #555;
    font-weight: 500;
}

.button.invalid {
    background-color: #dc3545;
    pointer-events: none;
}

.button.invalid:hover {
    background-color: #dc3545;
}

.form-input {
    width: 100%;
    padding: 0.75rem;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 1rem;
    transition: all 0.3s ease;
    background-color: white;
    appearance: none; 
}

select.form-input {
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 1rem center;
    background-size: 1em;
    padding-right: 2.5rem;
}

select.form-input option[value=""] {
    color: #666;
}

.form-input:focus {
    outline: none;
    border-color: #666;
}

.button {
    background: #333;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 0.75rem 1.5rem;
    font-size: 1rem;
    cursor: pointer;
    transition: background 0.3s ease;
    width: 100%;
}

.button:hover {
    background: #444;
}

.error-message {
    color: #dc3545;
    font-size: 0.875rem;
    margin-top: 0.5rem;
    display: none;
}

#addDistanceView {
    display: none;
}

@media (max-width: 600px) {
    body {
        padding: 1rem;
    }

    .container {
        padding: 1rem;
    }

    .title {
        font-size: 2rem;
    }

    .leaderboard-entry {
        flex-direction: column;
        text-align: center;
        gap: 0.5rem;
    }
}
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div>
                <h1 class="title">Movember</h1>
                <h2 class="subtitle">Sheaffe House</h2>
            </div>
            <div class="user-controls">
                <button class="icon-button" id="addButton">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
        </header>

        <section class="progress-section">
            <h3 class="progress-title">Total Distance Walked:</h3>
            <div class="progress-bar">
                <span class="progress-text"></span>
                <div class="footsteps">
                    <i class="fas fa-shoe-prints footstep"></i>
                    <i class="fas fa-shoe-prints footstep"></i>
                    <i class="fas fa-shoe-prints footstep"></i>
                    <i class="fas fa-shoe-prints footstep"></i>
                    <i class="fas fa-shoe-prints footstep"></i>
                </div>
            </div>
        </section>

        <section class="leaderboard-section">
            <h3 class="leaderboard-title">Leaderboard</h3>
        </section>
    </div>

    <div class="modal-overlay" id="modalOverlay">
        <div class="modal" id="loginModal">
            <button class="modal-close" id="modalClose">
                <i class="fas fa-times"></i>
            </button>
            
            <div id="loginView">
                <h2 class="modal-title">Login to Add Distance</h2>
                <form id="loginForm">
                    <div class="form-group">
                        <label class="form-label" for="lastName">Last Name</label>
                        <input type="text" id="lastName" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="yearLevel">Year Level</label>
                        <select id="yearLevel" class="form-input" required>
                            <option value="" disabled selected>Select year level</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            <option value="10">10</option>
                            <option value="11">11</option>
                        </select>
                    </div>
                    <div class="error-message" id="errorMessage">
                        User not found. Please check your details.
                    </div>
                    <button type="submit" class="button">Login</button>
                </form>
            </div>
            
            <div id="addDistanceView">
                <h2 class="modal-title" id="userFullName">Welcome</h2>
                <form id="distanceForm">
                    <div class="form-group">
                        <label class="form-label" for="distance">Distance (km)</label>
                        <input type="number" id="distance" class="form-input" step="0.01" required>
                    </div>
                    <button type="submit" class="button">Submit Distance</button>
                </form>
            </div>
        </div>
    </div>
    <script>
        const users = [
    {"firstName": "Ted", "lastName": "Niven", "yearLevel": 11},
    {"firstName": "Ioanna", "lastName": "Diamond", "yearLevel": 11},
    {"firstName": "Oliver", "lastName": "Susa", "yearLevel": 11},
    {"firstName": "Jeremy", "lastName": "Richardson", "yearLevel": 10},
    {"firstName": "Louise", "lastName": "Mann", "yearLevel": 10},
    {"firstName": "Bradley", "lastName": "Brown", "yearLevel": 10},
    {"firstName": "Nash", "lastName": "Kidner", "yearLevel": 9},
    {"firstName": "Zara", "lastName": "Herring", "yearLevel": 9},
    {"firstName": "Khann", "lastName": "Thai", "yearLevel": 8},
    {"firstName": "Catherine", "lastName": "Lim", "yearLevel": 8},
    
    {"firstName": "Carter", "lastName": "O'Sullivan", "yearLevel": 11},
    {"firstName": "Nellie", "lastName": "Byron", "yearLevel": 11},
    {"firstName": "Ben", "lastName": "McGregor", "yearLevel": 10},
    {"firstName": "Leo", "lastName": "Gao", "yearLevel": 10},
    {"firstName": "Eve", "lastName": "De Kleuver", "yearLevel": 10},
    {"firstName": "Ananya", "lastName": "Rai", "yearLevel": 9},
    {"firstName": "Gabriel", "lastName": "Bowman", "yearLevel": 9},
    {"firstName": "Christopher", "lastName": "Carroll", "yearLevel": 9},
    {"firstName": "Mia", "lastName": "Langevald", "yearLevel": 8},
    {"firstName": "Adam", "lastName": "Okera", "yearLevel": 8},
    {"firstName": "Dylan", "lastName": "Herath", "yearLevel": 8},
    
    {"firstName": "Dillon", "lastName": "Anderson", "yearLevel": 11},
    {"firstName": "Winnie", "lastName": "Herring", "yearLevel": 11},
    {"firstName": "Flora", "lastName": "Dong", "yearLevel": 11},
    {"firstName": "Ben", "lastName": "Jiang", "yearLevel": 10},
    {"firstName": "Maddie", "lastName": "Harris-Talbot", "yearLevel": 10},
    {"firstName": "Freddy", "lastName": "Gaffey", "yearLevel": 10},
    {"firstName": "Henry", "lastName": "Dolphin", "yearLevel": 9},
    {"firstName": "Abigail", "lastName": "Reiner", "yearLevel": 9},
    {"firstName": "Dylan", "lastName": "Campbell", "yearLevel": 8},
    {"firstName": "Vaishnavi", "lastName": "Raghav", "yearLevel": 8},
    {"firstName": "Iggy", "lastName": "Knight", "yearLevel": 8},
    
    {"firstName": "Ava", "lastName": "O'Donnell", "yearLevel": 11},
    {"firstName": "Oscar", "lastName": "Danta", "yearLevel": 11},
    {"firstName": "Charlie", "lastName": "McCarthy-Lee", "yearLevel": 10},
    {"firstName": "Abigail", "lastName": "Cowan", "yearLevel": 10},
    {"firstName": "Luca", "lastName": "Wah", "yearLevel": 10},
    {"firstName": "Caitlin", "lastName": "Anderson", "yearLevel": 9},
    {"firstName": "Michael", "lastName": "Dendrinos", "yearLevel": 9},
    {"firstName": "Oscar", "lastName": "Harris-Talbot", "yearLevel": 8},
    {"firstName": "Lexie", "lastName": "Fooks", "yearLevel": 8},
    {"firstName": "Hunter", "lastName": "Crawford", "yearLevel": 8},
    
    {"firstName": "Griffin", "lastName": "Hambly", "yearLevel": 11},
    {"firstName": "Brooke", "lastName": "Kilby", "yearLevel": 11},
    {"firstName": "Tristan", "lastName": "Hannan", "yearLevel": 10},
    {"firstName": "Milan", "lastName": "Bradaric", "yearLevel": 10},
    {"firstName": "Caitlin", "lastName": "Sheldon", "yearLevel": 10},
    {"firstName": "Nandan", "lastName": "Kottu", "yearLevel": 9},
    {"firstName": "Ava", "lastName": "Moulis", "yearLevel": 9},
    {"firstName": "Will", "lastName": "Hall", "yearLevel": 9},
    {"firstName": "Stan", "lastName": "Cleverly", "yearLevel": 8},
    {"firstName": "Amelie", "lastName": "Wertenauer", "yearLevel": 8},
    
    {"firstName": "Sophia", "lastName": "Smith", "yearLevel": 11},
    {"firstName": "Finn", "lastName": "Webber", "yearLevel": 11},
    {"firstName": "Dylan", "lastName": "Phelps", "yearLevel": 11},
    {"firstName": "Oliver", "lastName": "Terrell", "yearLevel": 10},
    {"firstName": "Nick", "lastName": "Andrea", "yearLevel": 10},
    {"firstName": "John", "lastName": "Nikias", "yearLevel": 10},
    {"firstName": "Archer", "lastName": "Doherty", "yearLevel": 9},
    {"firstName": "Issy", "lastName": "Massey", "yearLevel": 9},
    {"firstName": "Julian", "lastName": "Susa", "yearLevel": 8},
    {"firstName": "Ada", "lastName": "Duckworth", "yearLevel": 8},
    {"firstName": "Myrah", "lastName": "Dahal", "yearLevel": 8},
    
    {"firstName": "Lily", "lastName": "Bowman", "yearLevel": 11},
    {"firstName": "Alex", "lastName": "Gardner", "yearLevel": 11},
    {"firstName": "Will", "lastName": "Laverty", "yearLevel": 11},
    {"firstName": "Isaac", "lastName": "Halcrow", "yearLevel": 10},
    {"firstName": "Iona", "lastName": "Mcneil", "yearLevel": 10},
    {"firstName": "Aaron", "lastName": "Jones", "yearLevel": 10},
    {"firstName": "Matilda", "lastName": "Danta", "yearLevel": 9},
    {"firstName": "Ben", "lastName": "O'Donnell", "yearLevel": 9},
    {"firstName": "Sam", "lastName": "Andrea", "yearLevel": 9},
    {"firstName": "William", "lastName": "Plazier", "yearLevel": 8},
    {"firstName": "Ngala", "lastName": "Meredith", "yearLevel": 8},
    
    {"firstName": "Grace", "lastName": "Minney", "yearLevel": 11},
    {"firstName": "Archie", "lastName": "Vagg", "yearLevel": 11},
    {"firstName": "Iris", "lastName": "Rangiah", "yearLevel": 10},
    {"firstName": "Bradley", "lastName": "Ardler", "yearLevel": 10},
    {"firstName": "Lilli", "lastName": "Cheadle", "yearLevel": 10},
    {"firstName": "Chloe", "lastName": "Webber", "yearLevel": 9},
    {"firstName": "Darcy", "lastName": "Woodward", "yearLevel": 9},
    {"firstName": "Archer", "lastName": "Glaskin", "yearLevel": 8},
    {"firstName": "Miah", "lastName": "Howard", "yearLevel": 8},
    {"firstName": "George", "lastName": "De Kleuver", "yearLevel": 8}
];

// public/script.js

// Elements
const addButton = document.getElementById('addButton');
const modalOverlay = document.getElementById('modalOverlay');
const modalClose = document.getElementById('modalClose');
const loginForm = document.getElementById('loginForm');
const loginButton = loginForm.querySelector('button[type="submit"]');
const originalButtonText = loginButton.textContent;
const loginView = document.getElementById('loginView');
const addDistanceView = document.getElementById('addDistanceView');
const errorMessage = document.getElementById('errorMessage');
const userFullName = document.getElementById('userFullName');
let currentUser = null;

async function checkServerConnection() {
    try {
        const response = await fetch('http://13.55.183.170:3000/api/leaderboard');
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        console.log('Server connection successful');
        return true;
    } catch (error) {
        console.error('Server connection failed:', error);
        return false;
    }
}

// Event Listeners
addButton.addEventListener('click', () => {
    modalOverlay.style.display = 'flex';
    loginView.style.display = 'block';
    addDistanceView.style.display = 'none';
    errorMessage.style.display = 'none';
    loginForm.reset();
});

modalClose.addEventListener('click', closeModal);
modalOverlay.addEventListener('click', (e) => {
    if (e.target === modalOverlay) {
        closeModal();
    }
});

loginForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const lastName = document.getElementById('lastName').value;
    const yearLevel = parseInt(document.getElementById('yearLevel').value);

    const user = users.find(u => 
        u.lastName.toLowerCase() === lastName.toLowerCase() && 
        u.yearLevel === yearLevel
    );

    if (user) {
        currentUser = user;
        loginView.style.display = 'none';
        addDistanceView.style.display = 'block';
        userFullName.textContent = `Welcome, ${user.firstName} ${user.lastName}`;
        loginButton.textContent = originalButtonText;
        loginButton.classList.remove('invalid');
    } else {
        loginButton.textContent = 'Invalid User';
        loginButton.classList.add('invalid');
        setTimeout(() => {
            loginButton.textContent = originalButtonText;
            loginButton.classList.remove('invalid');
        }, 2000);
    }
});

// Add the distance form submit handler
const distanceForm = document.getElementById('distanceForm');
distanceForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const distanceInput = document.getElementById('distance');
    const distance = parseFloat(distanceInput.value);
    
    if (distance <= 0) {
        alert('Please enter a valid distance');
        return;
    }

    const payload = {
        firstName: currentUser.firstName,
        lastName: currentUser.lastName,
        yearLevel: currentUser.yearLevel,
        distance: distance
    };

    console.log('Submitting distance payload:', payload);

    try {
        const response = await fetch('http://13.55.183.170:3000/api/distance', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(payload)
        });

        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json();
        console.log('Server response:', data);
        
        if (data.success) {
            alert('Distance added successfully!');
            distanceForm.reset();
            closeModal();
            updateLeaderboard();
        } else {
            alert(`Error adding distance: ${data.error}`);
        }
    } catch (error) {
        console.error('Error submitting distance:', error);
        alert(`Error adding distance: ${error.message}`);
    }
});

async function updateLeaderboard() {
    try {
        const response = await fetch('http://13.55.183.170:3000/api/leaderboard');
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const users = await response.json();
        console.log('Leaderboard data:', users);
        
        const leaderboardSection = document.querySelector('.leaderboard-section');
        leaderboardSection.innerHTML = '<h3 class="leaderboard-title">Leaderboard</h3>';
        
        let totalDistance = 0;
        
        users.forEach((user, index) => {
            totalDistance += user.totalDistance || 0;
            
            const entry = document.createElement('div');
            entry.className = 'leaderboard-entry';
            entry.innerHTML = `
                <span class="rank">${index + 1}${getRankSuffix(index + 1)} Place</span>
                <span class="participant">${user.firstName} ${user.lastName}</span>
                <span class="distance">${(user.totalDistance || 0).toFixed(1)}km</span>
            `;
            leaderboardSection.appendChild(entry);
        });
        
        document.querySelector('.progress-text').textContent = `${totalDistance.toFixed(1)}km`;
    } catch (error) {
        console.error('Error updating leaderboard:', error);
        // Don't show alert for leaderboard errors, just log to console
    }
}

function getRankSuffix(rank) {
    if (rank > 3 && rank < 21) return 'th';
    switch (rank % 10) {
        case 1: return 'st';
        case 2: return 'nd';
        case 3: return 'rd';
        default: return 'th';
    }
}

function closeModal() {
    modalOverlay.style.display = 'none';
    loginForm.reset();
    errorMessage.style.display = 'none';
}

// Initialize leaderboard on page load
document.addEventListener('DOMContentLoaded', async () => {
    const serverAvailable = await checkServerConnection();
    if (serverAvailable) {
        updateLeaderboard();
    } else {
        console.error('Unable to connect to server');
    }
});


    </script>
</body>
</html>